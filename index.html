<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Actividades T茅cnicas</title>
    <link rel="stylesheet" href="assets/styles.css?v=32">
</head>
<body>
    <div class="container">
        <header>
            <img src="assets/logo.png" alt="Logo MPF La Rioja" class="header-logo">
            <h1>Registro de Actividades T茅cnicas</h1>
            <p>Ministerio P煤blico Fiscal - La Rioja</p>
        </header>

        <div class="header-actions">
            <button type="button" id="btnSolicitantes" class="btn-solicitantes" onclick="abrirModalSolicitantes()"> Solicitantes</button>
            <button type="button" id="exportBtn" class="btn-export" onclick="event.preventDefault(); event.stopPropagation();"> Exportar Datos</button>
        </div>

        <main>
            <section class="form-section">
                <h2>Nueva Actividad</h2>
                <form id="activityForm">
                    <div class="form-group">
                        <label for="fecha">Fecha:</label>
                        <input type="date" id="fecha" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="tecnico">T茅cnico:</label>
                        <select id="tecnico" required>
                            <option value="">Seleccione el t茅cnico</option>
                            <option value="Carlos Beres">Carlos Beres</option>
                            <option value="Santiago Somerville">Santiago Somerville</option>
                            <option value="Omar Vallejos">Omar Vallejos</option>
                            <option value="Maximiliano Burela Tello">Maximiliano Burela Tello</option>
                            <option value="Ricardo Cuello">Ricardo Cuello</option>
                            <option value="Jorge Olmedo">Jorge Olmedo</option>
                            <option value="Lucas Vega">Lucas Vega</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="tipo">Tipo de Actividad:</label>
                        <select id="tipo" required>
                            <option value="">Seleccione el tipo</option>
                            <option value="mantenimiento">Mantenimiento</option>
                            <option value="reparacion">Reparaci贸n</option>
                            <option value="instalacion">Instalaci贸n</option>
                            <option value="soporte">Soporte T茅cnico</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="solicitante">Solicitante:</label>
                        <div class="solicitante-input-group">
                            <input type="text" id="solicitante" placeholder="Escriba para buscar solicitantes..." required>
                            <input type="hidden" id="solicitanteId">
                            <button type="button" id="abrirModalPersonas" class="btn-seleccionar-persona"></button>
                            <div id="sugerenciasSolicitante" class="sugerencias-container"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="descripcion">Descripci贸n:</label>
                        <textarea id="descripcion" placeholder="Describa la actividad realizada..." rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="estado">Estado:</label>
                        <select id="estado" required>
                            <option value="">Seleccione estado</option>
                            <option value="completado">Completado</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="en-progreso">En progreso</option>
                        </select>
                    </div>
                    
                    <button type="submit">Registrar Actividad</button>
                </form>
            </section>

            <section class="list-section">
                <h2>Actividades Registradas</h2>
                <div class="filters">
                    <input type="text" id="searchInput" placeholder="Buscar actividades...">
                    <select id="filterTipo">
                        <option value="">Todos los tipos</option>
                        <option value="mantenimiento">Mantenimiento</option>
                        <option value="reparacion">Reparaci贸n</option>
                        <option value="instalacion">Instalaci贸n</option>
                        <option value="soporte">Soporte T茅cnico</option>
                        <option value="otro">Otro</option>
                    </select>
                    <select id="filterEstado">
                        <option value="">Todos los estados</option>
                        <option value="completado">Completado</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="en-progreso">En progreso</option>
                    </select>
                </div>
                
                <div id="activitiesList" class="activities-list">
                    <!-- Las actividades se cargar谩n aqu铆 -->
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para gesti贸n de personas (Solo formulario de nuevo solicitante) -->
    <div id="modalPersonas" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Nuevo Solicitante</h2>
            </div>
            
            <div class="modal-body">
                <!-- Solo formulario para nueva persona -->
                <div class="new-person-section">
                    <form id="formularioPersona">
                        <div class="form-row">
                            <input type="text" id="nuevaPersonaNombre" placeholder="Nombre" required>
                            <input type="text" id="nuevaPersonaApellido" placeholder="Apellido" required>
                        </div>
                        <div class="form-row">
                            <select id="nuevaPersonaCircunscripcion" required>
                                <option value="">Seleccione circunscripci贸n</option>
                                <option value="Primera Circunscripci贸n Capital">Primera Circunscripci贸n Capital</option>
                                <option value="Segunda Circunscripci贸n Chilecito">Segunda Circunscripci贸n Chilecito</option>
                                <option value="Tercera Circunscripci贸n Chamical">Tercera Circunscripci贸n Chamical</option>
                                <option value="Cuarta Circunscripci贸n Aimogasta">Cuarta Circunscripci贸n Aimogasta</option>
                                <option value="Quinta Circunscripci贸n Chepes">Quinta Circunscripci贸n Chepes</option>
                                <option value="Sexta Circunscripci贸n Villa Uni贸n">Sexta Circunscripci贸n Villa Uni贸n</option>
                            </select>
                            <select id="nuevaPersonaCargo" required>
                                <option value="">Seleccione cargo</option>
                                <option value="Operador">Operador</option>
                                <option value="Fiscal">Fiscal</option>
                            </select>
                        </div>
                        <div class="form-buttons">
                            <button type="submit">Agregar Solicitante</button>
                            <button type="button" id="btnCancelarModal" class="btn-cancelar">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para gesti贸n de solicitantes -->
    <div id="modalSolicitantes" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3> Gesti贸n de Solicitantes</h3>
                <span class="close" onclick="cerrarModalSolicitantes()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Barra de b煤squeda -->
                <div class="search-section">
                    <input type="text" id="buscarSolicitante" placeholder=" Buscar por nombre, apellido, cargo o circunscripci贸n..." class="search-input-large">
                </div>
                
                <!-- Tabla de solicitantes -->
                <div class="tabla-container">
                    <table class="tabla-solicitantes">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Circunscripci贸n</th>
                                <th>Cargo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaSolicitantes">
                            <!-- Los datos se cargar谩n din谩micamente -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Mensaje cuando no hay resultados -->
                <div id="mensajeSinResultados" class="no-results" style="display: none;">
                    <p>No se encontraron solicitantes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmaci贸n para eliminar actividades -->
    <div id="modalConfirmacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>锔 Confirmar Eliminaci贸n</h3>
                <span class="close" onclick="cerrarModalConfirmacion()">&times;</span>
            </div>
            <div class="modal-body">
                <p>驴Est谩 seguro de que desea eliminar esta actividad?</p>
                <p class="texto-advertencia">Esta acci贸n no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancelar" onclick="cerrarModalConfirmacion()">Cancelar</button>
                <button type="button" class="btn-confirmar" onclick="confirmarEliminacion()">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <script src="gestor-solicitantes.js"></script>
    <script src="modelo/modelo.js"></script>
    <script src="modelo/modelo-personas.js"></script>
    <script src="vista/vista.js"></script>
    <script src="vista/vista-formulario-solicitante.js"></script>
    <script src="controlador/controlador.js"></script>
    <script src="aplicacion.js"></script>
    
    <!-- Modal de Confirmaci贸n -->

    <!-- Modal de Edici贸n de Actividades -->
    <div id="modalEdicionActividad" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>锔 Editar Actividad</h3>
                <span class="close" onclick="cerrarModalEdicionActividad()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formEdicionActividad">
                    <input type="hidden" id="edicionActividadId">
                    
                    <div class="form-group">
                        <label for="edicionFecha">Fecha:</label>
                        <input type="date" id="edicionFecha" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edicionTecnico">T茅cnico:</label>
                        <select id="edicionTecnico" required>
                            <option value="">Seleccione el t茅cnico</option>
                            <option value="Carlos Beres">Carlos Beres</option>
                            <option value="Santiago Somerville">Santiago Somerville</option>
                            <option value="Omar Vallejos">Omar Vallejos</option>
                            <option value="Maximiliano Burela Tello">Maximiliano Burela Tello</option>
                            <option value="Ricardo Cuello">Ricardo Cuello</option>
                            <option value="Jorge Olmedo">Jorge Olmedo</option>
                            <option value="Lucas Vega">Lucas Vega</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edicionTipo">Tipo de Actividad:</label>
                        <select id="edicionTipo" required>
                            <option value="">Seleccione el tipo</option>
                            <option value="mantenimiento">Mantenimiento</option>
                            <option value="reparacion">Reparaci贸n</option>
                            <option value="instalacion">Instalaci贸n</option>
                            <option value="soporte">Soporte T茅cnico</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edicionSolicitante">Solicitante:</label>
                        <div class="solicitante-input-group">
                            <input type="text" id="edicionSolicitante" placeholder="Solicitante" readonly>
                            <input type="hidden" id="edicionSolicitanteId">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edicionDescripcion">Descripci贸n:</label>
                        <textarea id="edicionDescripcion" placeholder="Describa la actividad realizada..." rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="edicionEstado">Estado:</label>
                        <select id="edicionEstado" required>
                            <option value="">Seleccione estado</option>
                            <option value="completado">Completado</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="en-proceso">En proceso</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-cancelar" onclick="cerrarModalEdicionActividad()">Cancelar</button>
                        <button type="submit" class="btn-guardar"> Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="modalConfirmacion" class="modal-confirmacion" style="display: none;">
        <div class="modal-contenido">
            <div class="modal-header">
                <h3>Confirmar Eliminaci贸n</h3>
                <button class="btn-cerrar" onclick="cerrarModalConfirmacion()"></button>
            </div>
            <div class="modal-body">
                <p id="mensajeConfirmacion">驴Est谩 seguro de eliminar al solicitante?</p>
                <div class="modal-acciones">
                    <button class="btn-cancelar" onclick="cerrarModalConfirmacion()">Cancelar</button>
                    <button class="btn-confirmar" onclick="confirmarEliminacion()">Eliminar</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>